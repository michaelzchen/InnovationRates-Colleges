---
title: "Gather"
author: "Michael Chen"
date: "3/16/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

# Load libraries

library(tidyverse)
library(dplyr)
library(readr)
library(janitor)
library(gt)
library(rvest)
library(scales)
library(ggplot2)
library(ggthemes)
library(urbnmapr)
library(broom)
library(ggmap)
library(gganimate)
```

```{r downloading, include = FALSE, cache = TRUE}

# Read in the 2 datasets

colleges <- read_csv("1005 final project data/Most-Recent-Cohorts-All-Data-Elements (1).csv")
innovationRates <- read_csv("1005 final project data/innovationRates.csv")

# Clean the 2 datasets

colleges <- clean_names(colleges, "snake")
innovationRates <- clean_names(innovationRates, "snake")

# View the colleges dataset in long form, so that you can better see the different variables and select only the ones that matter for this project
```

```{r cleaning, include = FALSE}

# Select out only the variables that we are interested in the colleges dataset.
# We want to keep all the variables in the innovationRates dataset so don't
# change anything found there. Store this new data in the newColleges dataset.
# In addition, because we know we eventually want to join these 2 datasets so we
# can perform analysis,

newColleges <- colleges %>%
  select(-insturl, -accredagency, -hcm2, -main, -starts_with("cip"), -starts_with("c150"), -starts_with("num"), -starts_with("dep"), -starts_with("ind"), -starts_with("female"), -starts_with("male"), -starts_with("loan"), -starts_with("noloan"), -starts_with("firstgen"), -starts_with("not1stgen"), -starts_with("pell"), -starts_with("nopell"), -starts_with("low_inc"), -starts_with("mid_inc"), -starts_with("hi_inc"), -starts_with("npt4"), -contains("rpy"), -starts_with("count"), -starts_with("mn_earn"), -starts_with("d150"), -starts_with("om"), -starts_with("ret"), -starts_with("pool"), -unitid, -opeid) %>%
  mutate(super_opeid = str_sub(opeid6, 3, -1)) %>%
  select(super_opeid, everything()) %>%
  select(-opeid6)

# Need to convert the super_opeid data frame into a numeric column so we can join the 2 together in both datasets.

newColleges$super_opeid <- as.numeric(as.character(newColleges$super_opeid))

# Use an inner join to merge the 2 datasets by super_opeid (the ID variable for each institution) and keep all the columns in both of the datasets.

joined <- inner_join(innovationRates, newColleges, by = "super_opeid")

# Remove the duplicates (if the super_opeid is the same, delete)

newJoined <- joined[!duplicated(joined$super_opeid), ]
final <- newJoined %>% select(-instnm.y)
```

```{r ggplot, warning = FALSE}

# Now that I have the tibble I am interested in (called final), I can now create several plots. The first is a regression of admissions rate for each college against the inventors rate.

final$adm_rate <- as.numeric(as.character(final$adm_rate))

ggplot(final, aes(x = adm_rate, inventor, color = inventor)) +
  geom_jitter() +
  geom_smooth(method = "loess", se = TRUE) +
  labs(title = "Regression of Admissions Rate Against Inventors", x = "Admissions Rate", y = "Percentage of Students That Are Inventors", caption = "Data Source: Opportunity Insights and College Scorecard Project") +
  scale_y_continuous(labels = scales::percent) +
  scale_x_continuous(labels = scales::percent)

ggsave("Inventors-College/Reg_Adm_Rates_Inventors.png")
```

```{r}
ggplot(final, aes(x = as.numeric(first_gen), inventor, color = inventor)) +
  geom_jitter() +
  geom_smooth(method = "loess", se = TRUE) +
  labs(title = "Regression of Percent of 1st Gen Students Against Inventors", x = "Share of 1st Gen", y = "Percentage of Students That Are Inventors", caption = "Data Source: Opportunity Insights and College Scorecard Project") +
  scale_y_continuous(labels = scales::percent) +
  scale_x_continuous(labels = scales::percent)

ggsave("Inventors-College/Reg_1st_Gen_Inventors.png")
```

```{r}
ggplot(final, aes(x = as.numeric(pftfac), inventor, color = inventor)) +
  geom_jitter() +
  geom_smooth(method = "loess", se = TRUE) +
  labs(title = "Regression of Percent of Full Time Faculty Against Inventors", x = "Percent of Full Time Faculty", y = "Percentage of Students That Are Inventors", caption = "Data Source: Opportunity Insights and College Scorecard Project") +
  scale_y_continuous(labels = scales::percent) +
  scale_x_continuous(labels = scales::percent)

ggsave("Inventors-College/Reg_Perc_Faculty_Inventors.png")
```
